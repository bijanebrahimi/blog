<!DOCTYPE html>
<html lang="en">
<head>
        <title>Installing OpenBSD 6.3 on Raspberry pi 3</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="http://bijanebrahimi.github.io/blog/theme/css/main.css" />
        <link href="http://bijanebrahimi.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Routines Excluded Full Atom Feed" />
        <link href="http://bijanebrahimi.github.io/blog/feeds/openbsd.atom.xml" type="application/atom+xml" rel="alternate" title="Routines Excluded Categories Atom Feed" />
</head>
<body>

    <div class="navigation pure-menu pure-menu-horizontal">
        <a href="http://bijanebrahimi.github.io/blog/" class="pure-menu-heading  pure-menu-link">Routines Excluded</a>
        <ul class="pure-menu-list">
            <li class="pure-menu-item"></li>

            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/pages/bookmarks.html" class="pure-menu-link">Bookmarks</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/books.html" class="pure-menu-link">Books</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/freebsd.html" class="pure-menu-link">FreeBSD</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/gist.html" class="pure-menu-link">Gist</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/git.html" class="pure-menu-link">Git</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/linux.html" class="pure-menu-link">Linux</a></li>
            <li class="pure-menu-item pure-menu-selected"><a href="http://bijanebrahimi.github.io/blog/category/openbsd.html" class="pure-menu-link">OpenBSD</a></li>
            <li class="pure-menu-item"><a href="http://bijanebrahimi.github.io/blog/category/projects.html" class="pure-menu-link">Projects</a></li>
        </ul>
    </div>


<div class="page-container">
    <div class="entry-content">
        <div class="post-meta pure-g">
<div class="pure-u-3-4 meta-data">
    <a href="http://bijanebrahimi.github.io/blog/category/openbsd.html" class="category">OpenBSD</a><br />

    <a class="author" href="http://bijanebrahimi.github.io/blog/author/bijan.html">Bijan</a>
    &mdash; <abbr title="2018-04-08T21:35:00+04:30">Sun 08 April 2018</abbr>
</div>        </div>
    </div>

    <div class="article-header-container">
        <div class="background-image-container">

            <div class="background-image-small">
                <div class="title-container">
                    <h1>Installing OpenBSD 6.3 on Raspberry pi 3</h1>
                    <h4>The Easy way</h4>
                </div>
            </div>
        </div>
    </div>

    <div class="entry-content">
        <p>Installing the OpenBSD on raspberry pi 3 is very easy and <a href="https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64/INSTALL.arm64">well documented</a>
which almost convinced me of not writing about it, but still I felt like it may
help somebody new to the project (But again I really recommend reading the
document if you are interested and have the time).</p>
<p><strong>Note</strong>: I'm always running <a href="https://ftp.openbsd.org/pub/OpenBSD/snapshots/arm64">snapshots</a> and recommend anybody to do it as
well. But the snapshots links will change to the next version every 6 month, so I
changed the links to the <a href="https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64">6.3</a> version to keep the blog post valid over times.
If you're familiar to the OpenBSD <a href="https://www.openbsd.org/faq/faq5.html#Flavors">flavors</a>, feel free to use the snapshots
links instead.</p>
<h2>Requirements</h2>
<p>Due to the lack of driver, the OpenBSD can not boot directly from the SD Card yet,
So we'll need an USB Stick for the installtion target aside the SD Card for the
U-Boot and installer. Also, a Serial Console connection is required. I Used a
PL2303 USB to Serial (TTL) adapter connected to my Laptop via USB port and
connected to the Raspberry via <strong>TX</strong>, <strong>RX</strong> and <strong>GND</strong> pins.</p>
<h2>Installation</h2>
<p>For the RaspberryPi, I found the installation process the easiest using the
<a href="https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64/miniroot63.fs">miniroot</a> image. It's currently a 20MB filesystem image containing only the
installer script. For installing the base system, atleast the <a href="https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64/bsd.mp">bsd</a> kernel
and the <a href="https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64/base63.tgz">base</a> file sets are also required. you can choose <a href="https://www.openbsd.org/faq/faq4.html#FilesNeeded">more file sets</a>
if you like:</p>
<div class="highlight"><pre><span></span>$ wget https://ftp.openbsd.org/pub/OpenBSD/6.3/arm64/<span class="o">{</span>SHA256,SHA256.sig,miniroot63.fs,bsd,bsd.mp,base63.tgz,man63.tgz<span class="o">}</span>
</pre></div>


<p>The image and file sets can then be verified according the <a href="https://www.openbsd.org/faq/faq4.html">faq</a> using <code>sha256</code>.
Remember that if you mix the release and snapshot file sets, the checksum will
disagree:</p>
<div class="highlight"><pre><span></span>$ sha256 -C  SHA256 bsd* *.tgz miniroot*.fs
<span class="o">(</span>SHA256<span class="o">)</span> base63.tgz: OK
<span class="o">(</span>SHA256<span class="o">)</span> bsd: OK
<span class="o">(</span>SHA256<span class="o">)</span> bsd.mp: OK
<span class="o">(</span>SHA256<span class="o">)</span> man63.tgz: OK
<span class="o">(</span>SHA256<span class="o">)</span> miniroot63.fs: OK
</pre></div>


<p>Now to deal with the file sets. the possibilities are to place the file
sets on another USB stick or make them accessible over the local network. I used
python's <code>http.server</code> module to serve the filesets over http on my Laptop:</p>
<div class="highlight"><pre><span></span>$ doas python3.6 -m http.server 80
</pre></div>


<p>Then, we need to copy the installer
to the SD Card which you of course needs a running operating system for that. Any would
do, and here's mine on OpenBSD with SD Card recognized as the <code>sd1</code>:</p>
<div class="highlight"><pre><span></span>$ doas dd <span class="k">if</span><span class="o">=</span>miniroot63.fs <span class="nv">of</span><span class="o">=</span>/dev/rsd1c <span class="nv">bs</span><span class="o">=</span>1m
</pre></div>


<p>Now it's time to plug the SD card and the USB Stick to the RaspberryPi3 turn the
power on to let the <code>autoboot</code> process boot the installer automatically:</p>
<div class="highlight"><pre><span></span>$ cu -dl /dev/ttyU0 -s 115200
Connected to /dev/ttyU0 <span class="o">(</span>speed 115200<span class="o">)</span>


U-Boot 2018.03 <span class="o">(</span>Mar <span class="m">20</span> <span class="m">2018</span> - 04:28:27 -0600<span class="o">)</span>

DRAM:  <span class="m">948</span> MiB
RPI <span class="m">3</span> Model B <span class="o">(</span>0xa02082<span class="o">)</span>
MMC:   mmc@7e202000: 0, sdhci@7e300000: 1
Loading Environment from FAT... *** Warning - bad CRC, using default environment

Failed <span class="o">(</span>-5<span class="o">)</span>
In:    serial
Out:   vidconsole
Err:   vidconsole
Net:   No ethernet found.
starting USB...
USB0:   Core Release: 2.80a
scanning bus <span class="m">0</span> <span class="k">for</span> devices... <span class="m">5</span> USB Device<span class="o">(</span>s<span class="o">)</span> found
       scanning usb <span class="k">for</span> storage devices... <span class="m">1</span> Storage Device<span class="o">(</span>s<span class="o">)</span> found
Hit any key to stop autoboot:  <span class="m">0</span> 
switch to partitions <span class="c1">#0, OK</span>
mmc0 is current device
Scanning mmc 0:1...
Found EFI removable media binary efi/boot/bootaa64.efi
Scanning disk mmc@7e202000.blk...
Card did not respond to voltage <span class="k">select</span>!
Scanning disk sdhci@7e300000.blk...
Disk sdhci@7e300000.blk not ready
Scanning disk usb_mass_storage.lun0...
Found <span class="m">6</span> disks
<span class="m">97355</span> bytes <span class="nb">read</span> in <span class="m">7</span> ms <span class="o">(</span>13.3 MiB/s<span class="o">)</span>
<span class="c1">## Starting EFI application at 01000000 ...</span>
&gt;&gt; OpenBSD/arm64 BOOTAA64 0.12
boot&gt; 
</pre></div>


<p>Thanks to the text based installer, the Installation process is pretty much
identical across architectures, so it's the typical <code>miniroot</code> installation.
You can configure the the <code>smsc0</code> Ethernet interface or use a Wifi dongle
to fetch the file stes. I used my local network to fetch the file sets</p>
<div class="highlight"><pre><span></span>Welcome to the OpenBSD/arm64 6.3 installation program.
<span class="o">(</span>I<span class="o">)</span>nstall, <span class="o">(</span>U<span class="o">)</span>pgrade, <span class="o">(</span>A<span class="o">)</span>utoinstall or <span class="o">(</span>S<span class="o">)</span>hell? 
</pre></div>


<p>After Setting root's password and partitioning the USB stick, it's time to install
the sets. Just ensure you checked only sets that you downloaded:</p>
<div class="highlight"><pre><span></span>Let<span class="s1">&#39;s install the sets!</span>
<span class="s1">Location of sets? (disk http nfs or &#39;</span><span class="k">done</span><span class="s1">&#39;) [disk] http</span>
<span class="s1">HTTP proxy URL? (e.g. &#39;</span>http://proxy:8080<span class="s1">&#39;, or &#39;</span>none<span class="s1">&#39;) [none] </span>
<span class="s1">HTTP Server? (hostname, list#, &#39;</span><span class="k">done</span><span class="s1">&#39; or &#39;</span>?<span class="s1">&#39;) 192.168.10.10</span>
<span class="s1">Server directory? [pub/OpenBSD/snapshots/arm64] /</span>
<span class="s1">Unable to connect using https. Use http instead? [no] yes</span>

<span class="s1">Select sets by entering a set name, a file name pattern or &#39;</span>all<span class="s1">&#39;. De-select</span>
<span class="s1">sets by prepending a &#39;</span>-<span class="s1">&#39;, e.g.: &#39;</span>-game*<span class="s1">&#39;. Selected sets are labelled &#39;</span><span class="o">[</span>X<span class="o">]</span><span class="s1">&#39;.</span>
<span class="s1">    [X] bsd           [X] base63.tgz    [X] game63.tgz    [X] xfont63.tgz</span>
<span class="s1">    [X] bsd.mp        [X] comp63.tgz    [X] xbase63.tgz   [X] xserv63.tgz</span>
<span class="s1">    [X] bsd.rd        [X] man63.tgz     [X] xshare63.tgz</span>
<span class="s1">Set name(s)? (or &#39;</span>abort<span class="s1">&#39; or &#39;</span><span class="k">done</span><span class="err">&#39;</span><span class="o">)</span> <span class="o">[</span><span class="k">done</span><span class="o">]</span> -x* -com* -game* -bsd.rd
    <span class="o">[</span>X<span class="o">]</span> bsd           <span class="o">[</span>X<span class="o">]</span> base63.tgz    <span class="o">[</span> <span class="o">]</span> game63.tgz    <span class="o">[</span> <span class="o">]</span> xfont63.tgz
    <span class="o">[</span>X<span class="o">]</span> bsd.mp        <span class="o">[</span> <span class="o">]</span> comp63.tgz    <span class="o">[</span> <span class="o">]</span> xbase63.tgz   <span class="o">[</span> <span class="o">]</span> xserv63.tgz
    <span class="o">[</span> <span class="o">]</span> bsd.rd        <span class="o">[</span>X<span class="o">]</span> man63.tgz     <span class="o">[</span> <span class="o">]</span> xshare63.tgz
</pre></div>


<p>The rest is boring. But one important thing is to boot the OpenBSD after installation.
Since the U-Boot by default will prefer the SD Card, We need to
change it on the first boot which is done easily by interrupting the <code>autoboot</code>
by pressing any key and running the <code>setenv boot_targets usb0 mmc0 dhcp</code> and then
<code>boot</code> command:</p>
<div class="highlight"><pre><span></span><span class="n">U</span><span class="o">-</span><span class="n">Boot</span> <span class="mf">2018.03</span> <span class="p">(</span><span class="n">Mar</span> <span class="mi">20</span> <span class="mi">2018</span> <span class="o">-</span> <span class="mo">04</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">27</span> <span class="o">-</span><span class="mo">0600</span><span class="p">)</span>

<span class="nl">DRAM</span><span class="p">:</span>  <span class="mi">948</span> <span class="n">MiB</span>
<span class="n">RPI</span> <span class="mi">3</span> <span class="n">Model</span> <span class="n">B</span> <span class="p">(</span><span class="mh">0xa02082</span><span class="p">)</span>
<span class="nl">MMC</span><span class="p">:</span>   <span class="n">mmc</span><span class="mf">@7e202000</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sdhci</span><span class="mf">@7e300000</span><span class="o">:</span> <span class="mi">1</span>
<span class="n">Loading</span> <span class="n">Environment</span> <span class="n">from</span> <span class="n">FAT</span><span class="p">...</span> <span class="o">***</span> <span class="n">Warning</span> <span class="o">-</span> <span class="n">bad</span> <span class="n">CRC</span><span class="p">,</span> <span class="n">using</span> <span class="k">default</span> <span class="n">environment</span>

<span class="n">Failed</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="nl">In</span><span class="p">:</span>    <span class="n">serial</span>
<span class="nl">Out</span><span class="p">:</span>   <span class="n">vidconsole</span>
<span class="nl">Err</span><span class="p">:</span>   <span class="n">vidconsole</span>
<span class="nl">Net</span><span class="p">:</span>   <span class="n">No</span> <span class="n">ethernet</span> <span class="n">found</span><span class="p">.</span>
<span class="n">starting</span> <span class="n">USB</span><span class="p">...</span>
<span class="nl">USB0</span><span class="p">:</span>   <span class="n">Core</span> <span class="nl">Release</span><span class="p">:</span> <span class="mf">2.80</span><span class="n">a</span>
<span class="n">scanning</span> <span class="n">bus</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">devices</span><span class="p">...</span> <span class="mi">5</span> <span class="n">USB</span> <span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">found</span>
       <span class="n">scanning</span> <span class="n">usb</span> <span class="k">for</span> <span class="n">storage</span> <span class="n">devices</span><span class="p">...</span> <span class="mi">1</span> <span class="n">Storage</span> <span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">found</span>
<span class="n">Hit</span> <span class="n">any</span> <span class="n">key</span> <span class="n">to</span> <span class="n">stop</span> <span class="nl">autoboot</span><span class="p">:</span>  <span class="mi">0</span> 
<span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="o">&gt;</span> <span class="n">setenv</span> <span class="n">boot_targets</span> <span class="n">usb0</span> <span class="n">mmc0</span> <span class="n">dhcp</span>
<span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="o">&gt;</span> <span class="n">boot</span>

<span class="n">Device</span> <span class="mi">0</span><span class="o">:</span> <span class="nl">Vendor</span><span class="p">:</span> <span class="n">SanDisk</span> <span class="nl">Rev</span><span class="p">:</span> <span class="mf">1.00</span> <span class="nl">Prod</span><span class="p">:</span> <span class="n">Ultra</span> <span class="n">Fit</span>
            <span class="nl">Type</span><span class="p">:</span> <span class="n">Removable</span> <span class="n">Hard</span> <span class="n">Disk</span>
            <span class="nl">Capacity</span><span class="p">:</span> <span class="mf">14663.6</span> <span class="n">MB</span> <span class="o">=</span> <span class="mf">14.3</span> <span class="n">GB</span> <span class="p">(</span><span class="mi">30031250</span> <span class="n">x</span> <span class="mi">512</span><span class="p">)</span>
<span class="p">...</span> <span class="n">is</span> <span class="n">now</span> <span class="n">current</span> <span class="n">device</span>
<span class="n">Scanning</span> <span class="n">usb</span> <span class="mi">0</span><span class="o">:</span><span class="mf">1.</span><span class="p">..</span>
<span class="n">Found</span> <span class="n">EFI</span> <span class="n">removable</span> <span class="n">media</span> <span class="n">binary</span> <span class="n">efi</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">bootaa64</span><span class="p">.</span><span class="n">efi</span>
<span class="n">Scanning</span> <span class="n">disk</span> <span class="n">mmc</span><span class="mf">@7e202000</span><span class="p">.</span><span class="n">blk</span><span class="p">...</span>
<span class="n">Card</span> <span class="n">did</span> <span class="n">not</span> <span class="n">respond</span> <span class="n">to</span> <span class="n">voltage</span> <span class="n">select</span><span class="o">!</span>
<span class="n">Scanning</span> <span class="n">disk</span> <span class="n">sdhci</span><span class="mf">@7e300000</span><span class="p">.</span><span class="n">blk</span><span class="p">...</span>
<span class="n">Disk</span> <span class="n">sdhci</span><span class="mf">@7e300000</span><span class="p">.</span><span class="n">blk</span> <span class="n">not</span> <span class="n">ready</span>
<span class="n">Scanning</span> <span class="n">disk</span> <span class="n">usb_mass_storage</span><span class="p">.</span><span class="n">lun0</span><span class="p">...</span>
<span class="n">Found</span> <span class="mi">6</span> <span class="n">disks</span>
<span class="mi">97355</span> <span class="n">bytes</span> <span class="n">read</span> <span class="k">in</span> <span class="mi">90</span> <span class="n">ms</span> <span class="p">(</span><span class="mi">1</span> <span class="n">MiB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>
<span class="cp">## Starting EFI application at 01000000 ...</span>
<span class="o">&gt;&gt;</span> <span class="n">OpenBSD</span><span class="o">/</span><span class="n">arm64</span> <span class="n">BOOTAA64</span> <span class="mf">0.12</span>
<span class="n">boot</span><span class="o">&gt;</span> 
</pre></div>


<p>Hope it helps! Cheers.</p>
    </div>

    <footer>
        <div class="tags">
            <a href="http://bijanebrahimi.github.io/blog/tag/openbsd.html">openbsd</a>
            <a href="http://bijanebrahimi.github.io/blog/tag/raspberrypi.html">raspberrypi</a>
        </div>
        <div class="pure-g post-footer">
            <div class="pure-u-1 pure-u-md-1-2">
                <div class="pure-g poster-info">
                    <div class="pure-u">
                        <a href="http://bijanebrahimi.github.io/blog/author/bijan.html"><img src="http://gravatar.com/avatar/7596946117736307374be0d29ba22ffd" alt=""></a>
                    </div>
                    <div class="pure-u-3-4">
                        <h3 class="author-name"><a href="http://bijanebrahimi.github.io/blog/author/bijan.html">Bijan</a></h3>
                        <p class="author-description">
                          
            I Love to Read, Code and Explore the Possibilities.
        
                        </p>
                    </div>
                </div>
            </div>



        </div>


    </footer>

    <div class="entry-content">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'bijanebrahimi';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

</div>



    <footer class="index-footer">

        <a href="http://bijanebrahimi.github.io/blog/" title="Routines Excluded">Routines Excluded</a>
        <a href="http://bijanebrahimi.github.io/blog/category/books.html">Books</a>
        <a href="http://bijanebrahimi.github.io/blog/category/freebsd.html">FreeBSD</a>
        <a href="http://bijanebrahimi.github.io/blog/category/gist.html">Gist</a>
        <a href="http://bijanebrahimi.github.io/blog/category/git.html">Git</a>
        <a href="http://bijanebrahimi.github.io/blog/category/linux.html">Linux</a>
        <a href="http://bijanebrahimi.github.io/blog/category/openbsd.html">OpenBSD</a>
        <a href="http://bijanebrahimi.github.io/blog/category/projects.html">Projects</a>
        <a href="https://github.com/bijanebrahimi/blog">Fork Me on Github</a>

    </footer>

</body>
</html>